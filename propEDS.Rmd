---
title: "Proprioceptive precision in EDS"
author:
- Holly Clayton
- Bernard Marius 't Hart
- Denise Y.P. Henriques
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

# Introduction

In this study we want to replicate that people with Ehlers-Danlos Syndrome (EDS) have lower proprioceptive precision than age-matched controls [Clayton et al., XXXX]. We do this with a different method than before, which allows comparing proprioception with predicted sensory consequences. We also have Beighton scores for all participants so that we can see if hypermobility is correlated to proprioceptive precision. The paradigm is exactly the same as in a previous study [Modchalingam et al., 2019] from which we used the non-instructed variant with a rotation of 30 degrees. This could be used as a reference.

The main hypothesis is that in people with EDS, the proprioceptive signals are less reliable, so that precision of proprioceptive hand localization (without any other feedback) will also be less reliable.

The main measurements we use in this study come from a hand localization task. Participant's unseen, right hands are moved to some location. Directly above their right hand is a touch screen, and participants use the index finger of their visible, left hand to indicate where they think their right hand is. The movement with the right hand can be made by a robot, so that participants have an afferent, proprioceptive signal to estimate the location of their right hand. They can also self-generate the movement, so that in addition to afferent information, they also have efferent-based predicted sensory consequences to localize their hand with.

Participants do these two hand localization tasks after training movements with cursor that is aligned with the hand in a first session, and also after training with a cursor that represents the hand position, just rotated 30 degrees around the start position. Training with such rotated feedback is thought to lead to updates in efference-based predicted sensory consequences as well as proprioceptive recalibration. Both of these can be used in hand localization, but we think only the afferent, proprioceptive signal is affected by EDS.

Nevertheless, we will also analyze the data from the reach training session, to see if both people with EDS and controls learn at the same rate and to the same extent. While this is not directly relevant to our hypothesis, we will also test if implicit and explicit motor adaptation (as measured with a PDP procedure applied to reach aftereffects in no-cursor reaching). Here you can see all the data analyses we used, from pre-processing the raw data to published figures and reported statistics. All code and data can be checked and changed or even improved.

# Setting up the R environment

We recommend running the code in the R markdown notebook using R Studio, but it should be possible to run the functions from the R source files in a straightforward installation of R as well.

Packages we want:
```{r}
library('ez')
library('svglite')
```

We've kept the dependencies to a minimum. If either of the two packages is not available on your system, you can install them with this command: `install.packages(c('ez','svglite'))`.

There is some code we wrote to do all the pre-processing, create figures and do analyses. Importing the sources below will not do much by itself, as the files only contain functions we defined.
```{r}
source('R/common.R')
source('R/learningcurves.R')
source('R/reach_aftereffects.R')
source('R/localization_shifts.R')
source('R/localization_precision.R')
source('R/data.R')
```

If this ran without errors so far, all the functions we need are available.

We still need data. For this notebook, we can simply download pre-processed data files from OSF, but you can choose to download the raw data, and run / check / change pre-processing functions yourself. To do that change the variable `usePreprocessed` to FALSE.

```{r}

usePreprocessed <- TRUE
#usePreprocessed <- FALSE

if (usePreprocessed) {
  
  getPreprocessedData()
  
} else {
  
  getPreprocessedData(participantsOnly=TRUE)
  
  # This function is from data.R and downloads and unzips a zip file with the raw data:
  getRawData()
  
  # This function is from learningcurves.R and creates the pre-processed learning-curve files:
  getLearningCurves()
  
  # This function is from reach_aftereffects.R creates the nocursors / reachaftereffect files:
  getAllNoCursors()
  
  
  # The following functions are from localization_shifts.R.
  # This one creates the corrected [group_]localization.csv files:
  getLocalization()
  # This one calculates 95% confidence intervals for plotting:
  getLocalizationTdistributionConfidenceIntervals()
  # This one creates the loc_AOV files to do statistics on:
  getLocalizationForANOVA()
  
  # This function is from localization_precision.R and creates the files with participants' localization variance:
  getLocalizationVariance() 
  
}
```

Now that both code and data are available, we can start.

# Adaptation in people with EDS and Controls

First, we look at the adaptation to the 30 degree rotation, to see if the two groups adapt an equally amount and equally fast.

Plot learning curves:
```{r fig.width=8, fig.height=3}
plotLearningCurves(target='inline')
```

So it looks like the people with EDS and the controls learn about as much and equally fast. But we'll put that to the test here.

Learning curves ANOVA:
```{r}
learningCurveANOVA()
```

This ANOVA finds no difference between the two groups, nor an interaction between group and block. There is an effect of block. We interpret this to mean that both groups learned, and that there is no discernable difference in their rate or asymptotic level of learning.

# Reach Aftereffects in people with EDS and Controls

First a figure:
```{r fig.width=8, fig.height=3}
plotReachAftereffects(target='inline')
```

Now, we'll compare the aligned no-cursor deviations with those in the without strategy ("exclusive") no-cursor deviations after rotated training, in a mixed-design ANOVA with the between subjects factor _group_ (EDS or control) and the within subject factor _training_ (aligned or rotated).

```{r}
NoCursorANOVA()
```

There is an effect of training, but no effect of group and no interaction between group and training. We interpret this to mean that there is no discernable difference between the groups in their level of adaptation as measured by the shift from no-cursor reach deviations after aligned cursor training to those in "without strategy" no-cursor reach deviations after rotated training.

Now, let's see if there is any effect of group (EDS or control) on the effect of doing no-cursor reaches with or without strategy:

```{r}
RAE.ANOVA()
```

There is indeed a weak interaction between group and strategy use (F(1,28)=4.52, p=.042, $\eta^2$=0.05). There seems to indeed be a small difference between the EDS and control groups in the reach aftereffects _with_ strategy, and we'll verify this. However, it doesn't seem like there is a (big) difference within each group between _with_ and _without_ strategy reach aftereffects, which we'll test now.

```{r}
NoCursorTtests()
```

Some people in the control group here were apparently able to develop a strategy given only a 30 degree rotation and no instruction (contrary to our earlier findings: Modchalingam et al., 2019). Perhaps a few people in the group of participants with EDS were also able to develop a strategy, but not so many that it caused a difference between this group's averages in the _with_ and _without_ strategy conditions.

This does not necessarily mean that there is an effect of EDS on explicit learning. Rather it seems that the control group we measured here is somewhat different from the control group we recorded for an earlier study, while the EDS group is not [Modchalingam et al., 2019].

# Localization

So now we will look at the measure of interest: hand localization. But before testing the precision of hand localization, we will first test if it shifts and if it shifts differently from the control group. Based on our earlier study with people with EDS, we do not expect this.

First a plot of the shifts in localization responses, induced by rotated training:

```{r fig.width=8, fig.height=3}
plotLocalizationShifts(target='inline')
```

To clarify, all figures have the aligned localization responses subtracted.

Looks like there is an effect of training on localization (data in panels A & B seem different from 0). It also looks like there is no difference between the two groups (controls and people with EDS) in both the active and passive localization. It does seem like there is a difference between shifts in active and passive hand localization (data in panel C is somewhat different from 0), but it's unclear if there is a group difference there. Let's run a bunch of ANOVA's.

What are the factors?

angle = hand angle: one of 45, 90 and 135

```{r}
localizationAOV()
```

This mostly confirms what the figure shows: effects of training on localization, a difference between active and passive localization, but no effects of group. There is one oddity: the effect of passive vs. active localization interacts with the effect of hand angle in the omnibus ANOVA. This may be explained by the almost flat passive localization curves, while in active localization, the shifts appear larger at 45 and 90 degrees compared to 135. However, even if this is the case here, that should not concern our main question.

# Localization precision

Now the interesting part. We've mostly not seen any differences between the two groups which is what we expected. The exception is the _with strategy_ reach aftereffects, but for the current study, the more important issue is that there were no group effects on any of the localization measures. The question is if using this fast method of assessing proprioceptive recalibration we find the same effect as earlier (Clayton et al., XXXX) [@Clayton1234]: that people with EDS have larger/smaller proprioceptive precision. (The wider confidence interval in the group of people with EDS in the difference between active and passive localization shifts may be due to differences between individuals localization shifts, but not their proprioceptive hand localization precision.)

After subtracting a smoothed spline fit to each individual participants localization errors across hand angles, in each of the 4 conditions, which should factor out individual levels of accuracy, we are then left with the precision of their responses in all 4 conditions. Of those we take the variance, but for frequentist stats, it is more useful to use the standard deviation (as it gets the data more or less normally distributed), so we convert the variance to standard deviation before doing statistics.

Here are the standard deviations (square root of the variance) as our measure of precision of localization, for both the control group (in red) and the people with EDS (in blue). In panel A we see means and an estimate confidence interval assuming the data comes from a sample t-distribution. On the right is the localization precision in the aligned session, on the right in the rotated session. The continuous line is for active localization and the dashed line for passive. In panels B and C the individual data and the bootstrapped confidence interval are shown. Panel B is for the aligned session, and panel C for the rotated session. Each shows active (left) and passive (right) localization precision, for both the control group (red) and the group of participants with EDS (blue). 

```{r fig.width=8, fig.height=3}
plotLocalizationVariance()
```

In the figure it appears that localization is less precise in the group of people with EDS as compared with the control group.

Let's test this. Below is a mixed-design ANOVA on the standard deviation of localization, when using the group (control or EDS) as between-subjects factor and passive/active as well as aligned/rotated as within-subject factors.

```{r}
localizationSTD.ANOVA()
```

There is a main effect of group as well as a main effect of passive versus active localization, but there are no higher order effects. Let's do some one-sided t-tests to look into our hypothesis. One-sided, because we think that people with EDS should be less precise in localizing their hand:

```{r}
localicalizationSTDt.tests()
```

So apart from in aligned & active localization, people with EDS are indeed less precise in localizing their hand as compared to age-matched controls without EDS.

It also seems that the difference between active and passive is mostly the same within all conditions and groups. But, as mentioned, for the EDS group, active localization after aligned training might be more precise (lower variance) than in the other three conditions. Perhaps before changing it up with adaptation, the signal from predicted sensory consequences provides enough extra information to make a difference for hand location estimation.

# EDS indicators and hand localization precision

So if the precision of limb localization is lower in the EDS group, then perhaps there is a relationship between EDS indicators and the precision of limb localization. We use Beighton scores as a hypermobility index, measured in both groups, and test if this is correlated with overall localization variance (variance is now calculated across all 4 conditions for every participant - providing more power). First, let's plot this data, with a linear regression:

```{r fig.width=4, fig.height=4}
plotBeightonLocSTD()
```

This looks like there is some relationship between the two variables, and this is confirmed by a Pearson correlation:

```{r}
correlateBeightonLocSTD()
```

# Predict EDS from hand localization precision

This raises the question of whether or not EDS can be predicted from hand localization variance. The figure above shows there are quite a few people with EDS that are in the range of the control group though, so this might not be the case. However, with the localization variance calculated across all 4 conditions it does work to some extent:

```{r}
predictGroupBYlocvar()
```

Although I'm not using a training/test data split here which would be more appropriate, and perhaps we can make use of some other predictors as well (e.g. train a random forest that can make use of localization variance, and compare it to one that can not use localization variance), but all of this would require a lot more data (participants).

We can explore one issue with such a test: it would be best if it were cheap / easy to do. Training on a visuomotor rotation takes time, so the data from the rotated session might not be useful. Additionally, the passive localization requqires an expensive piece of equipment, which may be prohibitive. Therefore we should test how well predicting the group (people with EDS vs. controls) from localization variance works within each of the four hand localization conditions:

```{r}
localizationSTDlogreg()
```

Unfortunately, the predictions are useless in the condition that would be most easily used in a diagnostic setting. This is still done without training/test data splits, and still ignores co-predictors, which could reduce and increase power respectively. Nevertheless, at first glance, it seems that using hand localization precision is not a usefull predictor of EDS. 